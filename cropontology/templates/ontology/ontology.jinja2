{% extends 'page.jinja2' %}
{% import 'macros/form.jinja2' as form %}

{% block css %}
    {{ super() }}
{#    {% cssresource request,'main_library','graph_svg' %}#}

    <style type="text/css">
        #viz {
            width: 100%;
            height: 700px;
            border: 1px solid lightgray;
            font: 22pt arial;
        }

    </style>


{% endblock css %}

{% block breadcrums %}
    {% include 'ontology/snippets/breadcrums_ontology.jinja2' %}
{% endblock breadcrums %}

{% block main_container %}
    <div class="row">
        {% if request.h.has_section_content(request, ontology_id) %}
        <div class="col-lg-12">

                <div class="card">
                    <div class="card-body">
                        {{ request.h.get_section_content(request, ontology_id) }}
                    </div>
                </div>

        </div>
        {% endif %}

        <div class="col-md-12">
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Search {{ ontology_data.ontology_name }}</h3>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <form role="form" method="post" action="{{ request.url }}">
                  {{ form.secure_form(request) }}
                <div class="card-body">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Cypher Query</label>
                      <textarea id="cypher" name="cypher" class="form-control">{{ q }}</textarea>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="submit" id="reload" class="btn btn-primary">Submit</button>
                </div>
              </form>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card card-warning">
              <div class="card-header">
                <h3 class="card-title">Quick searches</h3>
              </div>
              <!-- /.card-header -->

              <div class="card-body">
                <button type="button" onclick="location.href='{{ request.route_url('ontology', ontology_id=ontology_id, _query={"q": 'MATCH (n)-[r]->(m) WHERE n.ontology_id=\'' + ontology_id + '\' AND m.ontology_id=\'' + ontology_id + '\' RETURN n,r,m limit 300'}) }}'" class="btn btn-default">Overall view</button>
                  <button type="button" onclick="location.href='{{ request.route_url('ontology', ontology_id=ontology_id, _query={"q": 'MATCH (n:Trait)-[r]->(m) WHERE n.ontology_id=\'' + ontology_id + '\' AND m.ontology_id=\'' + ontology_id + '\' RETURN n,r,m'}) }}'" class="btn btn-default">Traits</button>
              </div>
              <!-- /.card-body -->
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div id="viz"></div>
{#            Cypher query: <textarea rows="4" cols=50 id="cypher"></textarea><br>#}
{#            <input type="submit" value="Submit" id="reload">#}
{#            <input type="submit" value="Stabilize" id="stabilize">#}

            {#        <div id="split-container">#}
            {#            <a class="btn btn-default fit-button" id="fit-button">#}
            {#                Fit#}
            {#            </a>#}
            {#            <a class="btn btn-default thaw-button" id="thaw-button">#}
            {#                Thaw#}
            {#            </a>#}
            {#            <a class="btn btn-default png-button" id="png-button">#}
            {#                PNG#}
            {#            </a>#}
            {#            <a class="btn btn-default svg-button" id="svg-button">#}
            {#                SVG#}
            {#            </a>#}
            {#            <div id="graph-container">#}
            {#                <div id="graph"></div>#}
            {#            </div>#}
            {#            <div id="docs-container">#}
            {#                <a id="docs-close" href="#">&times;</a>#}
            {#                <div id="docs" class="docs"></div>#}
            {#            </div>#}
            {#        </div>#}
        </div>
    </div>
{% endblock main_container %}

{% block scripts %}
    {{ super() }}
    {% jsresource request,'main_library','neovis' %}

    <script type="text/javascript">
        // define config car
        // instantiate nodevis object
        // draw

        var viz;

        function draw() {
            var config = {
                container_id: "viz",
                server_url: "bolt://localhost:7687",
                server_user: "neo4j",
                server_password: "123",
                labels: {
                    "Term": {
                        "caption": "name",
                        "size": 1,
                        "community": "term_type",
                        //"sizeCypher": "MATCH (n) WHERE id(n) = {id} MATCH (n)-[r]-() RETURN sum(r.weight) AS c"
                    }
                },
                //relationships: {
                //    "INTERACTS": {
                //        "thickness": "weight",
                //        "caption": false
                //    }
                //},
                initial_cypher: "{{ q }}"
            };

            viz = new NeoVis.default(config);
            viz.render();
            console.log(viz);

        }
    </script>

    <script>
        $("#reload").click(function() {

            var cypher = $("#cypher").val();

            if (cypher.length > 3) {
                viz.renderWithCypher(cypher);
            } else {
                console.log("reload");
                viz.reload();

            }

        });

        $("#stabilize").click(function() {
            viz.stabilize();
        })

    </script>

    <script>
        $(document).ready(function() {
            draw();
        });
    </script>

{#    <script>#}
{#        var config = {{ json_config }};#}
{#    </script>#}
{#    {% jsresource request,'main_library','graph' %}#}
{% endblock scripts %}