{% extends 'page.jinja2' %}
{% import 'macros/form.jinja2' as form %}

{% block css %}
    {{ super() }}
    {% cssresource request,'main_library','switchery' %}
{% endblock css %}

{% block topScripts %}
    {{ super() }}
    {% jsresource request,'main_library','switchery' %}
{% endblock topScripts %}

{% block main_container %}
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    {% block user_add_title %}
                        <h2>{{ _('Edit user information') }}</h2>
                    {% endblock user_add_title %}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    {% block user_edit_content %}
                        {% block form_errors %}
                            {% if action == "modify" %}
                                {{ form.display_errors(errors) }}
                            {% endif %}
                        {% endblock form_errors %}
                        {% include 'user/snippets/user_form_edit.jinja2' %}
                    {% endblock user_edit_content %}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h5>{{ _('Change password') }}</h5>
                    {% block user_password_content %}
                        {% block password_errors %}
                            {% if action == "changepass" %}
                                {{ form.display_errors(errors) }}
                            {% endif %}
                        {% endblock password_errors %}
                        {% include 'user/snippets/user_password_form.jinja2' %}
                    {% endblock user_password_content %}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <form class="m-t" role="form" method="post" action="{{ request.url }}">
                    <div class="card-body">
                        <h5>{{ _('Allow to user manage the selected ontologies') }}
                            {% if selected_ontologies > 0 %}
                                ({{ selected_ontologies }}{{ _(' selected)') }}
                            {% endif %}
                        </h5>

                        {% if action == "changepass" %}
                            {{ form.display_errors(errors) }}
                        {% endif %}
                        <table class="table" style="">
                            <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">Ontology Name</th>
                                <th scope="col">Link</th>
                            </tr>
                            </thead>
                        </table>
                        <div style="position: relative;height: 400px;overflow: auto; display: block;">
                            <table class="table" style="">
                                <tbody>
                                {% for ontology in ontologies %}
                                    <tr>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                       value="{{ ontology.ontology_id }}"
                                                       id="flexCheckDefault" name="selected_flag"
                                                       {% if ontology.has_manager_permission %}checked{% endif %}/>
                                            </div>
                                        </td>
                                        <td>{{ ontology.ontology_name }} <input type="hidden"
                                                                                name="ontology_name"
                                                                                value="{{ ontology.ontology_id }}"/>
                                        </td>
                                        <td>
                                            <a href="{{ request.route_url("term_details", termid=ontology.ontology_id) }}:ROOT"
                                               target="_blank">
                                                <span {% if ontology.ontology_type == "obo" %}style="color: #4183C4"
                                                      {% else %}style="color: #4FA359"{% endif %}>
                                                    {{ ontology.ontology_name }}
                                                </span>
                                            </a>
                                        </td>
                                    </tr>

                                {% endfor %}

                                </tbody>
                            </table>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-4 col-sm-offset-2">
                                <button class="btn btn-danger btn-sm" type="submit"
                                        name="update_ontologies_access">{{ _('Update ontologies management access') }}</button>
                            </div>
                        </div>

                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock main_container %}

{% block scripts %}
    {{ super() }}
    <script>
        function uuidv4() {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }

        $(document).ready(function() {
            var elem = document.querySelector('.js-switch');
            var switchery = new Switchery(elem, { color: '#1AB394' });

            let elem2 = document.querySelector('.js-switch2');
            let switchery2 = new Switchery(elem2, { color: '#1AB394' });

            $('#genkey').click(function () {
                $('#user_apikey').val(uuidv4());
            });

        });
    </script>
{% endblock scripts %}

